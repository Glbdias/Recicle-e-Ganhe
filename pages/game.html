<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="/css/style_game.css" />
  <title>Recicla e Ganha</title>
</head>
<body>
  <!-- Tela Inicial -->
  <div id="inicio-container">
    <div>
      <h1>Bem-vindo ao "Recicla e Ganha"!</h1>
      <button id="start-button">Iniciar Jogo</button>
    </div>
  </div>

  <!-- V√≠deo de Introdu√ß√£o -->
  <div id="video-container" style="display: none;">
    <video id="intro-video" autoplay>
      <source src="/assets/video/introdu√ß√£o.mp4" type="video/mp4">
      Seu navegador n√£o suporta v√≠deo HTML5.
    </video>
    <button id="skip-button" style="
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: rgba(255, 255, 255, 0.8);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      z-index: 1001;
    ">Pular V√≠deo</button>
  </div>

  <!-- Conte√∫do do jogo (inicialmente oculto) -->
  <div id="game-container">
    <div class="container">
      <h1>‚ôªÔ∏è Recicla e Ganha</h1>
      <h2 id="fase-info">Fase 1</h2>
      <p>Vidas: <span id="vidas">3</span></p>
      <p>Tempo restante: <span id="tempo">30</span> segundos</p>

      <div class="card itens">
        <div id="itens-container"></div>
      </div>

      <div class="card lixeiras">
        <div class="lixeiras-container" id="lixeiras-container"></div>
      </div>
    </div>
  </div>

  <!-- Modal de Vit√≥ria -->
  <div id="telaVitoria" class="overlay" style="display: none;">
    <div class="box">
      <h1>üéâ Parab√©ns!</h1>
      <p>Voc√™ concluiu todas as fases!</p>
      <button onclick="reiniciarJogo()">Jogar Novamente</button>
    </div>
  </div>

  <!-- Modal de Game Over -->
  <div id="telaGameOver" class="overlay" style="display: none;">
    <div class="box">
      <h1>üíÄ Game Over</h1>
      <p>Voc√™ perdeu todas as vidas ou o tempo acabou!</p>
      <button onclick="reiniciarJogo()">Tentar Novamente</button>
    </div>
  </div>

  <script>
    let faseAtual = 1;
    let tempo = 30;
    let vidas = 3;
    let reciclados = 0;
    let totalItens;
    let timer;
    let videoAssistido = false;

    const backgroundImages = [
      '/assets/fases-background/1.png',
      // '/assets/fases-background/;.png',
      // '/assets/fases-background/3.png',
      // '/assets/fases-background/1.png',
      // '/assets/fases-background/1.png',
    ]

    const fases = [
      {
        itens: {
          "plastico": ['plastico'],
          "papel": ["papel", "papel1"]
        },
        lixeiras: {
          "papel": "azul",
          "plastico": "vermelha"
        }
      },
      {
        itens: {
          "plastico": ["teclas", "plastico1"],
          "papel": ["caderno", "papel1", "papel2"],
          "vidro": ["vidro1", "vidro2"]
        },
        lixeiras: {
          "papel": "azul",
          "plastico": "vermelha",
          "vidro": "verde"
        }
      },
      {
        itens: {
          "papel": ["caixa-papelao", "papel2"],
          "plastico": ["plastico2", "plastico1"],
          "vidro": ["vidro1", "vidro2"],
          "metal": ["metal1", "metal2", "metal3", "metal5"]
        },
        lixeiras: {
          "papel": "azul",
          "plastico": "vermelha",
          "vidro": "verde",
          "metal": "amarela"
        }
      },
      {
        itens: {
          "organico": ["organico1"],
          "papel": ["papel2", "papel1"],
          "metal": ["metal2"]
        },
        lixeiras: {
          "organico": "marrom",
          "papel": "azul",
          "metal": "amarela"
        }
      },
      {
        itens: {
          "eletronico": ["bateria", "controle"],
          "vidro": ["vidro1", "vidro2"],
          "plastico": ["plastico2"]
        },
        lixeiras: {
          "eletronico": "cinza",
          "vidro": "verde",
          "plastico": "vermelha"
        }
      }
    ];

    // Fun√ß√£o que inicia a fase do jogo
    function iniciarFase() {
      setFaseBackground();

      document.getElementById("fase-info").textContent = `Fase ${faseAtual}`;
      let fase = fases[faseAtual - 1];
      reciclados = 0;

      let itensContainer = document.getElementById("itens-container");
      itensContainer.innerHTML = "";

      let itensSelecionados = [];

      for (let tipo in fase.itens) {
        let opcoes = fase.itens[tipo];
        let escolha = opcoes[Math.floor(Math.random() * opcoes.length)];
        itensSelecionados.push({ tipo: tipo, img: escolha });
      }

      totalItens = itensSelecionados.length;

      itensSelecionados.forEach(({ tipo, img }) => {
        const el = document.createElement("img");
        
        el.style.position = "absolute";
        el.style.pointerEvents = "auto";
        el.style.width = "150px";
        el.style.background = "#fff";
        el.style.padding = "10px";
        el.style.borderRadius = "8px";

        const containerWidth = itensContainer.clientWidth;
        const containerHeight = itensContainer.clientHeight;
        const maxLeft = containerWidth - 100;
        const maxTop = containerHeight - 100;

        el.style.left = `${Math.random() * maxLeft}px`;
        el.style.top = `${Math.random() * maxTop}px`;
        el.src = `/assets/images/${img}.png`;
        el.alt = tipo;
        el.className = "lixo";
        el.draggable = true;
        el.id = img;
        el.dataset.tipo = tipo;
        el.ondragstart = drag;

        itensContainer.appendChild(el);
      });


      let lixeirasContainer = document.getElementById("lixeiras-container");
      lixeirasContainer.innerHTML = "";

      for (let tipo in fase.lixeiras) {
        let div = document.createElement("div");
        div.className = `lixeira`;
        div.ondrop = event => drop(event, tipo);
        div.ondragover = allowDrop;

        let img = document.createElement("img");
        img.src = `/assets/lixeiras/${tipo}.png`;
        img.alt = `Lixeira de ${tipo}`;
        img.className = "lixeira-img";
        div.appendChild(img);

        lixeirasContainer.appendChild(div);
      }

      iniciarTimer();
    }

    function setFaseBackground() {
      // let backgroundImage = backgroundImages[faseAtual];
      let backgroundImage = "/assets/fases-background/1.png";
      const gameContainer = document.querySelector(".container");
      gameContainer.style.backgroundImage = `url(${backgroundImage})`;
      gameContainer.style.backgroundRepeat = "no-repeat";
      gameContainer.style.backgroundSize = "cover";
      gameContainer.style.backgroundPosition = "center";
    }

    function iniciarTimer() {
      clearInterval(timer);
      tempo = 30 - (faseAtual * 2);
      if (tempo < 10) tempo = 10; // tempo m√≠nimo
      document.getElementById("tempo").textContent = tempo;
      timer = setInterval(() => {
        tempo--;
        document.getElementById("tempo").textContent = tempo;
        if (tempo === 0) {
          clearInterval(timer);
          mostrarGameOver();
        }
      }, 1000);
    }

    function allowDrop(event) {
      event.preventDefault();
    }

    function drag(event) {
      event.dataTransfer.setData("text", event.target.id);
    }

    function drop(event, tipoLixo) {
      event.preventDefault();
      let id = event.dataTransfer.getData("text");
      let elemento = document.getElementById(id);
      let tipoReal = elemento.dataset.tipo;

      if (tipoReal === tipoLixo) {
        event.target.appendChild(elemento);
        elemento.style.pointerEvents = "none";
        reciclados++;
        if (reciclados === totalItens) {
          clearInterval(timer);
          if (faseAtual < fases.length) {
            faseAtual++;
            iniciarFase();
          } else {
            mostrarVitoria();
          }
        }
      } else {
        vidas--;
        document.getElementById("vidas").textContent = vidas;
        alert("Ops! Esse lixo n√£o pertence a essa lixeira.");
        if (vidas === 0) {
          mostrarGameOver();
        }
      }
    }

    function mostrarGameOver() {
      document.getElementById("telaGameOver").style.display = "flex";
      clearInterval(timer);
    }

    function mostrarVitoria() {
      document.getElementById("telaVitoria").style.display = "flex";
      clearInterval(timer);
    }

    function reiniciarJogo() {
      faseAtual = 1;
      vidas = 3;
      reciclados = 0;
      document.getElementById("telaVitoria").style.display = "none";
      document.getElementById("telaGameOver").style.display = "none";
      document.getElementById("inicio-container").style.display = "flex";  // Exibe tela inicial novamente
      document.getElementById("game-container").style.display = "none";  // Esconde o jogo
    }

    // Quando o bot√£o de start for clicado, inicia o v√≠deo e o jogo
    document.getElementById('start-button').addEventListener('click', function() {
      document.getElementById('inicio-container').style.display = 'none';

      // Se o v√≠deo j√° foi assistido, inicia diretamente o jogo
      if (!videoAssistido) {
        document.getElementById('video-container').style.display = 'flex';
        document.getElementById('intro-video').play();
        document.getElementById('intro-video').onended = function() {
          videoAssistido = true;
          document.getElementById('video-container').style.display = 'none';
          document.getElementById('game-container').style.display = 'block';
          iniciarFase();
        };
      } else {
        document.getElementById('game-container').style.display = 'block';
        iniciarFase();
      }
    });

    document.getElementById('skip-button').addEventListener('click', function() {
      const video = document.getElementById('intro-video');
      video.pause(); 
      video.currentTime = 0; 
      videoAssistido = true;
      document.getElementById('video-container').style.display = 'none';
      document.getElementById('game-container').style.display = 'block';
      iniciarFase();
    });

  </script>
</body>
</html>
