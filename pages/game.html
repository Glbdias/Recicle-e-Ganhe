<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="/css/style_game.css" />
  <title>Recicla e Ganha</title>
  <style>
    .lixeira {
      display: inline-block;
      padding: 10px;
      text-align: center;
      margin: 10px;
      border-radius: 12px;
      background-color: #f0f0f0;
    }

    .lixeira-img {
      width: 100px;
      height: auto;
      user-select: none;
    }

    .lixo {
      width: 80px;
      height: auto;
      margin: 10px;
      cursor: grab;
    }

    .card {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background: #fff;
    }

    .lixeiras-container, #itens-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .box {
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }

  </style>
</head>
<body>
  <div class="container">
    <h1>‚ôªÔ∏è Recicla e Ganha</h1>
    <h2 id="fase-info">Fase 1</h2>
    <p>Vidas: <span id="vidas">3</span></p>
    <p>Tempo restante: <span id="tempo">30</span> segundos</p>

    <div class="card itens">
      <h2>Itens para reciclar</h2>
      <div id="itens-container"></div>
    </div>

    <div class="card">
      <h2>Lixeiras</h2>
      <div class="lixeiras-container" id="lixeiras-container"></div>
    </div>
  </div>

  <!-- Modal de Vit√≥ria -->
  <div id="telaVitoria" class="overlay" style="display: none;">
    <div class="box">
      <h1>üéâ Parab√©ns!</h1>
      <p>Voc√™ concluiu todas as fases!</p>
      <button onclick="reiniciarJogo()">Jogar Novamente</button>
    </div>
  </div>

  <!-- Modal de Game Over -->
  <div id="telaGameOver" class="overlay" style="display: none;">
    <div class="box">
      <h1>üíÄ Game Over</h1>
      <p>Voc√™ perdeu todas as vidas ou o tempo acabou!</p>
      <button onclick="reiniciarJogo()">Tentar Novamente</button>
    </div>
  </div>

  <script>
    let faseAtual = 1;
    let tempo = 30;
    let vidas = 3;
    let reciclados = 0;
    let totalItens;
    let timer;

    const fases = [
      {
        itens: {
          "plastico": ['plastico'],
          "papel": ["papel"]
        },
        lixeiras: {
          "papel": "azul",
          "plastico": "vermelha"
        }
      },
      {
        itens: {
          "plastico": ["teclas"],
          "papel": ["caderno"],
          "vidro": ["caneca"]
        },
        lixeiras: {
          "papel": "azul",
          "plastico": "vermelha",
          "vidro": "verde"
        }
      },
      {
        itens: {
          "papel": ["caixa-papelao"],
          "plastico": ["plastico3"],
          "vidro": ["vidro3"],
          "metal": ["metal1"]
        },
        lixeiras: {
          "papel": "azul",
          "plastico": "vermelha",
          "vidro": "verde",
          "metal": "amarela"
        }
      },
      {
        itens: {
          "organico": ["banana", "resto_comida"],
          "papel": ["papel6"],
          "metal": ["metal2"]
        },
        lixeiras: {
          "organico": "marrom",
          "papel": "azul",
          "metal": "amarela"
        }
      },
      {
        itens: {
          "eletronico": ["celular", "controle"],
          "vidro": ["vidro4"],
          "plastico": ["plastico4"]
        },
        lixeiras: {
          "eletronico": "cinza",
          "vidro": "verde",
          "plastico": "vermelha"
        }
      }
    ];

    function iniciarFase() {
      document.getElementById("fase-info").textContent = `Fase ${faseAtual}`;
      let fase = fases[faseAtual - 1];
      reciclados = 0;

      let itensContainer = document.getElementById("itens-container");
      itensContainer.innerHTML = "";

      let itensSelecionados = [];

      for (let tipo in fase.itens) {
        let opcoes = fase.itens[tipo];
        let escolha = opcoes[Math.floor(Math.random() * opcoes.length)];
        itensSelecionados.push({ tipo: tipo, img: escolha });
      }

      totalItens = itensSelecionados.length;

      itensSelecionados.forEach(({ tipo, img }) => {
        let el = document.createElement("img");
        el.src = `/assets/images/${img}.png`;
        el.alt = tipo;
        el.className = "lixo";
        el.draggable = true;
        el.id = img;
        el.dataset.tipo = tipo;
        el.ondragstart = drag;
        itensContainer.appendChild(el);
      });

      let lixeirasContainer = document.getElementById("lixeiras-container");
      lixeirasContainer.innerHTML = "";

      for (let tipo in fase.lixeiras) {
        let div = document.createElement("div");
        div.className = `lixeira`;
        div.ondrop = event => drop(event, tipo);
        div.ondragover = allowDrop;

        let img = document.createElement("img");
        img.src = `/assets/lixeiras/${tipo}.png`;
        img.alt = `Lixeira de ${tipo}`;
        img.className = "lixeira-img";
        div.appendChild(img);

        lixeirasContainer.appendChild(div);
      }

      iniciarTimer();
    }

    function iniciarTimer() {
      clearInterval(timer);
      tempo = 30 - (faseAtual * 2);
      if (tempo < 10) tempo = 10; // tempo m√≠nimo
      document.getElementById("tempo").textContent = tempo;
      timer = setInterval(() => {
        tempo--;
        document.getElementById("tempo").textContent = tempo;
        if (tempo === 0) {
          clearInterval(timer);
          mostrarGameOver();
        }
      }, 1000);
    }

    function allowDrop(event) {
      event.preventDefault();
    }

    function drag(event) {
      event.dataTransfer.setData("text", event.target.id);
    }

    function drop(event, tipoLixo) {
      event.preventDefault();
      let id = event.dataTransfer.getData("text");
      let elemento = document.getElementById(id);
      let tipoReal = elemento.dataset.tipo;

      if (tipoReal === tipoLixo) {
        event.target.appendChild(elemento);
        elemento.style.pointerEvents = "none";
        reciclados++;
        if (reciclados === totalItens) {
          clearInterval(timer);
          if (faseAtual < fases.length) {
            faseAtual++;
            iniciarFase();
          } else {
            mostrarVitoria();
          }
        }
      } else {
        vidas--;
        document.getElementById("vidas").textContent = vidas;
        alert("Ops! Esse lixo n√£o pertence a essa lixeira.");
        if (vidas === 0) {
          mostrarGameOver();
        }
      }
    }

    function mostrarGameOver() {
      document.getElementById("telaGameOver").style.display = "flex";
      clearInterval(timer);
    }

    function mostrarVitoria() {
      document.getElementById("telaVitoria").style.display = "flex";
      clearInterval(timer);
    }

    function reiniciarJogo() {
      location.reload();
    }

    iniciarFase();
  </script>
</body>
</html>
